<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ACI Migrator{% endblock %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        accent: {
                            500: '#8b5cf6',
                            600: '#7c3aed',
                        },
                        sidebar: {
                            dark: '#1e293b',
                            light: '#f8fafc',
                        }
                    }
                }
            }
        }
    </script>

    <!-- Custom CSS -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Sidebar transitions */
        .sidebar {
            transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
        }

        .sidebar-collapsed {
            transform: translateX(-100%);
        }

        @media (min-width: 768px) {
            .sidebar-collapsed {
                transform: translateX(0);
                width: 5rem;
            }
        }

        /* Content margin adjustment */
        .main-content {
            transition: margin-left 0.3s ease-in-out;
        }

        .main-content-expanded {
            margin-left: 16rem;
        }

        .main-content-collapsed {
            margin-left: 5rem;
        }

        @media (max-width: 767px) {
            .main-content-expanded,
            .main-content-collapsed {
                margin-left: 0;
            }
        }

        /* Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .animate-slide-down {
            animation: slideDown 0.3s ease-out;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .animate-slide-in-right {
            animation: slideInRight 0.3s ease-out;
        }

        /* Toast container */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        /* Gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .gradient-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        /* Sidebar hover effects */
        .sidebar-link {
            position: relative;
            transition: all 0.2s ease;
        }

        .sidebar-link:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .sidebar-link.active {
            background: rgba(59, 130, 246, 0.15);
            border-left: 3px solid #3b82f6;
        }

        .sidebar-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #3b82f6;
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>
<body class="h-full bg-gray-50 antialiased">

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed top-0 left-0 z-40 w-64 h-screen bg-slate-800 text-white shadow-2xl">
        <!-- Logo/Brand Section -->
        <div class="flex items-center justify-between p-4 border-b border-slate-700">
            <div class="flex items-center space-x-3">
                <div class="h-10 w-10 rounded-lg gradient-primary flex items-center justify-center shadow-lg">
                    <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                    </svg>
                </div>
                <div class="sidebar-text">
                    <h1 class="text-lg font-bold">ACI Migrator</h1>
                    <p class="text-xs text-slate-400">v1.01</p>
                </div>
            </div>
            <button id="sidebar-toggle" class="p-2 rounded-lg hover:bg-slate-700 transition-colors md:hidden">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <!-- Navigation Menu -->
        <nav class="flex-1 overflow-y-auto p-4 space-y-1">
            <a href="{{ url_for('index') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                <span class="sidebar-text">Home</span>
            </a>

            <!-- Fabric Manager Section (MOVED TO TOP - Below Home) -->
            <div class="border-t border-b border-slate-700 my-2 py-3">
                <button id="fabric-manager-toggle" class="w-full flex items-center justify-between text-left sidebar-text group px-4 py-2" onclick="toggleFabricManager()">
                    <span class="text-xs font-medium text-slate-300 uppercase tracking-wide group-hover:text-white transition-colors flex items-center space-x-2">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                        <span>Fabric Manager</span>
                    </span>
                    <svg id="fabric-manager-icon" class="h-4 w-4 text-slate-400 transform transition-transform duration-200 rotate-180 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>

                <div id="fabric-manager-content" class="mt-3 space-y-3 sidebar-text px-4">
                    <!-- Current Fabric Display -->
                    <div>
                        <label class="text-xs font-medium text-slate-400">Current Fabric</label>
                        <div class="mt-1 text-sm font-medium text-white truncate">
                            {{ session.get('current_fabric', 'None') }}
                        </div>
                    </div>

                    <!-- Fabric Selector -->
                    <div>
                        <label class="text-xs font-medium text-slate-400">Select Fabric</label>
                        <select id="fabric-selector" onchange="selectFabricFromSidebar(this.value)"
                                class="mt-1 w-full bg-slate-900 text-white text-xs rounded-md px-2 py-1.5 border border-slate-700 focus:border-primary-500 focus:outline-none">
                            <option value="">Choose fabric...</option>
                            {% for fabric in fabrics %}
                            <option value="{{ fabric.name }}" {% if session.get('current_fabric') == fabric.name %}selected{% endif %}>
                                {{ fabric.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Create New Fabric Button -->
                    <button onclick="showCreateFabricDialog()" class="w-full flex items-center justify-center px-3 py-2 rounded-md bg-primary-600 text-white text-xs font-medium hover:bg-primary-700 transition-colors">
                        <svg class="h-4 w-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Create Fabric
                    </button>

                    <!-- Delete Current Fabric -->
                    {% if session.get('current_fabric') %}
                    <button onclick="deleteFabricFromSidebar('{{ session.get('current_fabric') }}')" class="w-full flex items-center justify-center px-3 py-2 rounded-md bg-red-600 text-white text-xs font-medium hover:bg-red-700 transition-colors">
                        <svg class="h-4 w-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                        Delete Fabric
                    </button>
                    {% endif %}
                </div>
            </div>

            <a href="{{ url_for('upload_page') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
                <span class="sidebar-text">Upload</span>
            </a>

            <a href="{{ url_for('analyze') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                <span class="sidebar-text">Analyze</span>
            </a>

            <a href="{{ url_for('visualize') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/>
                </svg>
                <span class="sidebar-text">Visualize</span>
            </a>

            <a href="{{ url_for('plan') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
                </svg>
                <span class="sidebar-text">Plan</span>
            </a>

            <a href="{{ url_for('report') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <span class="sidebar-text">Report</span>
            </a>

            {% if mode == 'evpn' %}
            <a href="{{ url_for('evpn_migration_page') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                </svg>
                <span class="sidebar-text">EVPN Migration</span>
            </a>
            {% endif %}

            <a href="{{ url_for('help_page') }}" class="sidebar-link flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span class="sidebar-text">Help</span>
            </a>
        </nav>

        <!-- Mode Selector Section -->
        <div class="border-t border-slate-700 p-4">
            <div class="sidebar-text">
                <label class="text-xs font-medium text-slate-400 uppercase tracking-wide">Mode</label>
                <div class="mt-2 flex rounded-lg bg-slate-900 p-1">
                    <a href="{{ url_for('set_mode', mode='evpn') }}"
                       class="flex-1 text-center px-3 py-2 text-xs font-medium rounded-md transition-all duration-200
                              {% if mode == 'evpn' %}bg-purple-600 text-white shadow-lg{% else %}text-slate-400 hover:text-white{% endif %}">
                        EVPN
                    </a>
                    <a href="{{ url_for('set_mode', mode='onboard') }}"
                       class="flex-1 text-center px-3 py-2 text-xs font-medium rounded-md transition-all duration-200
                              {% if mode == 'onboard' %}bg-green-600 text-white shadow-lg{% else %}text-slate-400 hover:text-white{% endif %}">
                        Onboard
                    </a>
                </div>
            </div>
        </div>
    </aside>

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebar-overlay" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-30 md:hidden"></div>

    <!-- Main Content Area -->
    <div id="main-content" class="main-content main-content-expanded min-h-screen">
        <!-- Top Bar -->
        <header class="sticky top-0 z-20 bg-white border-b border-gray-200 shadow-sm">
            <div class="flex items-center justify-between px-4 sm:px-6 lg:px-8 h-16">
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="p-2 rounded-lg text-gray-600 hover:bg-gray-100 md:hidden">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>

                <!-- Page Title (Dynamic) -->
                <div class="flex-1 md:ml-0">
                    <h2 class="text-lg font-semibold text-gray-900">{% block page_title %}Dashboard{% endblock %}</h2>
                </div>

                <!-- Desktop Sidebar Toggle -->
                <button id="desktop-sidebar-toggle" class="hidden md:block p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Page Content -->
        <main class="px-4 sm:px-6 lg:px-8 py-8">
            <!-- Toast Container -->
            <div id="toast-container"></div>

            <!-- Content Block -->
            {% block content %}{% endblock %}
        </main>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 mt-auto">
            <div class="px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <p class="text-sm text-gray-500">
                        &copy; 2024-2025 ACI Migrator v1.01. Professional ACI to EVPN/VXLAN migration analysis tool.
                    </p>
                    <div class="flex space-x-6 mt-4 md:mt-0">
                        <a href="{{ url_for('help_page') }}" class="text-sm text-gray-500 hover:text-primary-600 transition-colors">Documentation</a>
                        <span class="text-sm text-gray-500">Mode: <strong class="text-primary-600">{{ mode|upper }}</strong></span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script>
        // Sidebar toggle functionality
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const mainContent = document.getElementById('main-content');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const desktopSidebarToggle = document.getElementById('desktop-sidebar-toggle');

        let sidebarExpanded = true;

        // Mobile menu toggle
        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.remove('sidebar-collapsed');
            sidebarOverlay.classList.remove('hidden');
        });

        // Close sidebar on overlay click
        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.add('sidebar-collapsed');
            sidebarOverlay.classList.add('hidden');
        });

        // Close button in sidebar
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.add('sidebar-collapsed');
                sidebarOverlay.classList.add('hidden');
            });
        }

        // Desktop sidebar toggle
        desktopSidebarToggle.addEventListener('click', () => {
            sidebarExpanded = !sidebarExpanded;

            if (sidebarExpanded) {
                sidebar.classList.remove('sidebar-collapsed');
                mainContent.classList.remove('main-content-collapsed');
                mainContent.classList.add('main-content-expanded');
                document.querySelectorAll('.sidebar-text').forEach(el => el.style.display = 'block');
            } else {
                sidebar.classList.add('sidebar-collapsed');
                mainContent.classList.remove('main-content-expanded');
                mainContent.classList.add('main-content-collapsed');
                document.querySelectorAll('.sidebar-text').forEach(el => el.style.display = 'none');
            }
        });

        // Highlight active nav item
        const currentPath = window.location.pathname;
        document.querySelectorAll('.sidebar-link').forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            }
        });

        // Toast notification function
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');

            const bgColors = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            };

            toast.className = `${bgColors[type]} text-white px-6 py-4 rounded-lg shadow-lg mb-4 animate-slide-in-right`;
            toast.textContent = message;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Make showToast available globally
        window.showToast = showToast;

        // Fabric Manager Toggle (Expanded by default)
        function toggleFabricManager() {
            const content = document.getElementById('fabric-manager-content');
            const icon = document.getElementById('fabric-manager-icon');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Initialize Fabric Manager as expanded on page load
        document.addEventListener('DOMContentLoaded', function() {
            const content = document.getElementById('fabric-manager-content');
            const icon = document.getElementById('fabric-manager-icon');
            // Already expanded by default in HTML
        });

        // Select fabric from sidebar dropdown
        function selectFabricFromSidebar(fabricName) {
            if (!fabricName) return;

            fetch(`/fabrics/${fabricName}/select`, {method: 'POST'})
                .then(response => response.json())
                .then(data => {
                    showToast(`Fabric "${fabricName}" selected`, 'success');
                    setTimeout(() => location.reload(), 1000);
                })
                .catch(error => {
                    showToast('Error selecting fabric', 'error');
                    console.error('Error:', error);
                });
        }

        // Delete fabric from sidebar
        function deleteFabricFromSidebar(fabricName) {
            if (confirm(`Are you sure you want to delete fabric "${fabricName}"? This action cannot be undone.`)) {
                fetch(`/fabrics/${fabricName}`, {method: 'DELETE'})
                    .then(response => response.json())
                    .then(data => {
                        showToast('Fabric deleted successfully', 'success');
                        setTimeout(() => location.reload(), 1000);
                    })
                    .catch(error => {
                        showToast('Error deleting fabric', 'error');
                        console.error('Error:', error);
                    });
            }
        }

        // Show create fabric dialog (will be defined in index.html if needed, or create here)
        function showCreateFabricDialog() {
            // Check if modal exists on current page
            const dialog = document.getElementById('create-fabric-dialog');
            if (dialog) {
                dialog.classList.remove('hidden');
                setTimeout(() => dialog.classList.add('opacity-100'), 10);
            } else {
                // If no modal on page, redirect to home
                window.location.href = '/?create_fabric=true';
            }
        }

        // Make functions globally available
        window.toggleFabricManager = toggleFabricManager;
        window.selectFabricFromSidebar = selectFabricFromSidebar;
        window.deleteFabricFromSidebar = deleteFabricFromSidebar;
        window.showCreateFabricDialog = showCreateFabricDialog;
    </script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
